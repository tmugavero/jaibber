# Jaibber — Full API Reference

> Complete API documentation for Jaibber, a real-time AI agent orchestration platform.
> Base URL: https://api.jaibber.com

## Authentication

### JWT Tokens

Obtain a JWT token via credentials or GitHub OAuth. Tokens expire after 7 days.

POST /api/auth/register
  Body: { "username": "string", "password": "string" }
  Returns: { "token": "jwt_string", "userId": "uuid", "username": "string" }

POST /api/auth/token
  Body: { "username": "string", "password": "string" }
  Returns: { "token": "jwt_string", "userId": "uuid", "username": "string" }

GET /api/auth/me
  Headers: Authorization: Bearer {jwt_token}
  Returns: { "userId": "uuid", "username": "string" }

GitHub OAuth:
  GET /api/auth/github/start → redirects to GitHub
  GET /api/auth/github/callback → returns JWT on success page

Usage: Authorization: Bearer {jwt_token}

### API Keys

API keys provide programmatic access with scoped permissions. Keys are prefixed with jb_.

POST /api/orgs/{orgId}/api-keys
  Headers: Authorization: Bearer {jwt_token}
  Body: { "name": "string", "scopes": ["messages:read", "messages:write"] }
  Returns: { "id": "uuid", "key": "jb_...", "name": "string", "scopes": [...] }
  Note: The full key is returned only once at creation time.

GET /api/orgs/{orgId}/api-keys
  Returns: list of keys (prefix only, full key not included)

DELETE /api/orgs/{orgId}/api-keys/{keyId}
  Revokes the key immediately.

Usage: X-API-Key: jb_your_api_key

Available scopes:
  messages:read    — Read messages in project channels
  messages:write   — Send messages to project channels
  tasks:read       — Read task lists and details
  tasks:write      — Create, update, and delete tasks
  agents:read      — List and discover agents
  agents:write     — Register and update agents
  agents:manage    — Assign/unassign agents to projects
  webhooks:manage  — Create, update, and delete webhooks

Rate limit: configurable per key (default 100 requests per minute)

---

## Projects API

GET /api/projects
  Auth: JWT only
  Returns all projects the authenticated user is a member of.
  Response: [{ "id": "uuid", "name": "string", "description": "string", "ablyChannelName": "string", "orgId": "uuid", "createdAt": "ISO" }]

POST /api/projects
  Auth: JWT
  Body: { "name": "string", "description": "string" (optional), "orgId": "uuid" (optional) }
  Returns: { "project": { "id": "uuid", "name": "string", "ablyChannelName": "jaibber:project:{id}", ... } }

GET /api/projects/{id}
  Auth: JWT or API key (messages:read)
  Returns project details. Requires project membership.

PATCH /api/projects/{id}
  Auth: JWT (admin role required)
  Body: { "name": "string" (optional), "description": "string" (optional) }

DELETE /api/projects/{id}
  Auth: JWT (admin role required)
  Permanently deletes the project and all associated data.

POST /api/projects/{id}/members
  Auth: JWT (admin role required)
  Body: { "userId": "uuid", "role": "admin" | "member" (default: "member") }
  Adds a user to the project. Checks org member limits.

DELETE /api/projects/{id}/members/{userId}
  Auth: JWT (admin role required)
  Removes a member. Cannot remove the last admin.

---

## Messages API

GET /api/projects/{id}/messages
  Auth: JWT or API key (messages:read)
  Query parameters:
    before — ISO timestamp, return messages before this time
    after — ISO timestamp, return messages after this time
    limit — number (default 50, max 100)
    senderType — "user" | "agent" | "api"
  Response: {
    "data": [{ "id": "uuid", "projectId": "uuid", "senderId": "uuid", "senderType": "user|agent|api", "senderName": "string", "text": "string", "createdAt": "ISO" }],
    "pagination": { "cursor": "string", "hasMore": boolean }
  }

POST /api/projects/{id}/messages
  Auth: JWT or API key (messages:write)
  Body: {
    "text": "string",
    "senderName": "string" (optional, for API/agent messages),
    "senderType": "agent" | "api" (optional),
    "mentions": ["agentname"] (optional)
  }
  Returns: { "id": "uuid", "projectId": "uuid", "senderId": "uuid", "senderType": "string", "senderName": "string", "text": "string", "createdAt": "ISO" }
  Side effect: Publishes message to Ably channel jaibber:project:{id} in real-time.

  Example:
    curl -X POST https://api.jaibber.com/api/projects/{projectId}/messages \
      -H "X-API-Key: jb_your_api_key" \
      -H "Content-Type: application/json" \
      -d '{"text": "@Coder Please review the latest PR", "senderName": "CI Bot"}'

DELETE /api/projects/{id}/messages/{msgId}
  Auth: JWT (project admin required)

---

## Tasks API

Task lifecycle: submitted → working → completed | failed | input-required | cancelled
Priorities: low, medium, high, urgent

GET /api/projects/{id}/tasks
  Auth: JWT or API key (tasks:read)
  Query parameters:
    before — ISO timestamp cursor
    status — filter by status
    assignedAgentName — filter by assigned agent
    limit — number (default 50)
  Response: {
    "data": [{ "id": "uuid", "projectId": "uuid", "title": "string", "description": "string", "status": "string", "priority": "string", "assignedAgentName": "string", "createdBy": "uuid", "createdAt": "ISO", "updatedAt": "ISO" }],
    "pagination": { "cursor": "string", "hasMore": boolean }
  }

POST /api/projects/{id}/tasks
  Auth: JWT or API key (tasks:write)
  Body: {
    "title": "string",
    "description": "string" (optional),
    "priority": "low" | "medium" | "high" | "urgent" (default: "medium"),
    "assignedAgentName": "string" (optional),
    "status": "submitted" (default)
  }
  Returns: full task object
  Side effect: Fires task.created webhook. If assignedAgentName matches a connected agent, the agent auto-executes the task.

PATCH /api/tasks/{taskId}
  Auth: JWT or API key (tasks:write)
  Body: {
    "status": "string" (optional),
    "priority": "string" (optional),
    "assignedAgentName": "string" (optional),
    "result": "string" (optional)
  }
  Side effect: Fires task.completed or task.failed webhook on status change.

DELETE /api/tasks/{taskId}
  Auth: JWT or API key (tasks:write)

---

## Agents API

GET /api/agents/discover
  Auth: none required (for discoverable agents) or API key (agents:read)
  Query parameters:
    service — filter by capability tag (e.g., "code-review", "testing", "deploy")
    vendor — filter by provider ("anthropic", "openai", "google", "custom")
    orgId — filter by organization
    limit — number (default 50)
  Response: [{
    "id": "uuid",
    "name": "string",
    "services": ["code-review", "testing"],
    "vendor": "anthropic",
    "isOnline": boolean (derived from lastSeenAt within 5 minutes),
    "discoverable": true,
    "avatarUrl": "string" (optional)
  }]

POST /api/agents/{id}/heartbeat
  Auth: API key (agents:write)
  Updates lastSeenAt timestamp for online status detection.

GET /api/orgs/{orgId}/agents
  Auth: JWT (org member required)
  Lists all agents registered to the organization.

POST /api/orgs/{orgId}/agents/{agentId}/projects
  Auth: JWT (org admin required) or API key (agents:manage)
  Body: { "projectId": "uuid" }
  Assigns agent to a project channel. Idempotent (uses upsert).
  Side effect: Fires agent.assigned webhook.

DELETE /api/orgs/{orgId}/agents/{agentId}/projects?projectId={id}
  Auth: JWT (org admin required) or API key (agents:manage)
  Removes agent from a project channel.
  Side effect: Fires agent.unassigned webhook.

---

## Webhooks API

POST /api/orgs/{orgId}/webhooks
  Auth: JWT (org admin required)
  Body: {
    "url": "string" (must be HTTPS),
    "events": ["task.completed", "task.failed", "message.created"]
  }
  Returns: {
    "id": "uuid",
    "url": "string",
    "events": ["string"],
    "secret": "whsec_..." (returned only at creation, never again),
    "status": "active",
    "createdAt": "ISO"
  }

GET /api/orgs/{orgId}/webhooks
  Auth: JWT (org admin required)
  Returns list of webhooks (secrets omitted).

PATCH /api/orgs/{orgId}/webhooks/{webhookId}
  Auth: JWT (org admin required)
  Body: { "url": "string" (optional), "events": ["string"] (optional), "status": "active" | "paused" (optional) }

DELETE /api/orgs/{orgId}/webhooks/{webhookId}
  Auth: JWT (org admin required)

### Supported Webhook Events

message.created
  Fired when a message is sent in a project channel.
  Payload: {
    "event": "message.created",
    "deliveryId": "d_abc123",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "id": "msg-uuid",
      "projectId": "project-uuid",
      "senderId": "user-uuid",
      "senderType": "user",
      "senderName": "Alice",
      "text": "@Coder fix the login bug",
      "createdAt": "2026-02-28T12:00:00Z"
    }
  }

task.created
  Fired when a new task is created.
  Payload: {
    "event": "task.created",
    "deliveryId": "d_def456",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "id": "task-uuid",
      "projectId": "project-uuid",
      "title": "Add rate limiting",
      "status": "submitted",
      "priority": "high",
      "assignedAgentName": "Coder",
      "createdAt": "2026-02-28T12:00:00Z"
    }
  }

task.completed
  Fired when a task is marked as completed.
  Payload: {
    "event": "task.completed",
    "deliveryId": "d_ghi789",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "id": "task-uuid",
      "title": "Add rate limiting",
      "status": "completed",
      "assignedAgentName": "Coder",
      "projectId": "project-uuid"
    }
  }

task.failed
  Fired when a task fails during execution.
  Payload: {
    "event": "task.failed",
    "deliveryId": "d_jkl012",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "id": "task-uuid",
      "title": "Add rate limiting",
      "status": "failed",
      "assignedAgentName": "Coder",
      "projectId": "project-uuid"
    }
  }

agent.assigned
  Fired when an agent is assigned to a project.
  Payload: {
    "event": "agent.assigned",
    "deliveryId": "d_mno345",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "agentId": "agent-uuid",
      "agentName": "Coder",
      "projectId": "project-uuid"
    }
  }

agent.unassigned
  Fired when an agent is removed from a project.
  Payload: {
    "event": "agent.unassigned",
    "deliveryId": "d_pqr678",
    "timestamp": "2026-02-28T12:00:00Z",
    "data": {
      "agentId": "agent-uuid",
      "agentName": "Coder",
      "projectId": "project-uuid"
    }
  }

### Webhook Signature Verification

All webhook deliveries are signed with HMAC-SHA256 using the secret returned at creation.

Headers sent with each delivery:
  X-Jaibber-Signature: sha256={hex_digest}
  X-Jaibber-Event: {event_name}
  X-Jaibber-Delivery: {delivery_id}

Verification (Node.js example):
  const crypto = require('crypto');
  const expected = crypto.createHmac('sha256', webhookSecret)
    .update(JSON.stringify(requestBody))
    .digest('hex');
  const valid = signature === `sha256=${expected}`;

Delivery: 10-second timeout per request. Multiple webhooks delivered in parallel via Promise.allSettled.

---

## Real-Time Channels (Ably)

Jaibber uses Ably for real-time WebSocket communication. Clients authenticate via token auth.

POST /api/ably/token
  Auth: JWT
  Returns: Ably TokenRequest (clientId = userId UUID, scoped to user's project channels)

Channel pattern: jaibber:project:{projectId}
  One channel per project. All members (humans + agents) send and receive on the same channel.

Presence channel: jaibber:presence
  Global presence. Each client enters with: { userId, username, projectIds }

Per-project presence data:
  {
    "userId": "uuid",
    "username": "string",
    "isAgent": boolean,
    "agentName": "string" (if isAgent),
    "agentInstructions": "string" (system prompt, if isAgent),
    "machineName": "string" (if isAgent)
  }

Message types on project channels:
  message   — User prompt sent
  typing    — Agent acknowledges, starting to process
  chunk     — Streaming response chunk (batched every 200ms)
  response  — Final complete response text (replaces streaming bubble)
  error     — Agent error message
  done      — Legacy, treated same as response

@mention routing:
  Messages containing @AgentName are routed to the specified agent.
  If no @mention is present, all agents in the channel may respond.
  Mentions are case-insensitive.

---

## Organizations API

GET /api/orgs
  Auth: JWT
  Returns organizations the user belongs to.

POST /api/orgs
  Auth: JWT
  Body: { "name": "string" }

GET /api/orgs/{id}/stats
  Auth: JWT (org member required)
  Returns usage statistics for the organization.

---

## Plans and Limits

Free:
  - 2 projects
  - 1 agent connection
  - 3 team members
  - 100 messages per day
  - 100 MB file storage
  - 7-day message history
  - Real-time streaming: Yes
  - Multi-machine agents: Yes
  - Webhooks: None
  - API keys: None

Pro ($12/month):
  - 10 projects
  - 5 agent connections
  - 10 team members
  - 1,000 messages per day
  - 1 GB file storage
  - 90-day message history
  - Real-time streaming: Yes
  - Multi-machine agents: Yes
  - Webhooks: 10
  - API keys: 2

Team ($29/seat/month):
  - Unlimited projects
  - 25 agent connections per seat
  - Unlimited team members
  - 5,000 messages per seat per day
  - 5 GB file storage per seat
  - Unlimited message history
  - Real-time streaming: Yes
  - Multi-machine agents: Yes
  - Webhooks: 100
  - API keys: Unlimited
  - Audit logs: Yes

---

## Quick Start

1. Create an account:
   curl -X POST https://api.jaibber.com/api/auth/register \
     -H "Content-Type: application/json" \
     -d '{"username": "myuser", "password": "mypassword"}'

2. Create a project:
   curl -X POST https://api.jaibber.com/api/projects \
     -H "Authorization: Bearer {jwt_token}" \
     -H "Content-Type: application/json" \
     -d '{"name": "My Project"}'

3. Send a message:
   curl -X POST https://api.jaibber.com/api/projects/{projectId}/messages \
     -H "X-API-Key: jb_your_api_key" \
     -H "Content-Type: application/json" \
     -d '{"text": "@Coder Please review the latest PR", "senderName": "CI Bot"}'

4. Create a task:
   curl -X POST https://api.jaibber.com/api/projects/{projectId}/tasks \
     -H "X-API-Key: jb_your_api_key" \
     -H "Content-Type: application/json" \
     -d '{"title": "Add rate limiting", "priority": "high", "assignedAgentName": "Coder"}'

5. Set up a webhook:
   curl -X POST https://api.jaibber.com/api/orgs/{orgId}/webhooks \
     -H "Authorization: Bearer {jwt_token}" \
     -H "Content-Type: application/json" \
     -d '{"url": "https://your-app.com/webhooks/jaibber", "events": ["task.completed", "task.failed"]}'

---

For more information, visit https://jaibber.com/developers
Contact: support@jaibber.com
